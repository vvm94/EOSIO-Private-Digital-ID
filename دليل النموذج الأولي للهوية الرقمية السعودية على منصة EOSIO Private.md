# دليل النموذج الأولي للهوية الرقمية السعودية على منصة EOSIO Private

## المحتويات

1. [مقدمة](#مقدمة)
2. [نظرة عامة على النظام](#نظرة-عامة-على-النظام)
3. [متطلبات النظام](#متطلبات-النظام)
4. [تثبيت وإعداد النظام](#تثبيت-وإعداد-النظام)
5. [هيكل المشروع](#هيكل-المشروع)
6. [العقود الذكية](#العقود-الذكية)
7. [واجهات برمجة التطبيقات (API)](#واجهات-برمجة-التطبيقات-api)
8. [واجهة المستخدم](#واجهة-المستخدم)
9. [اختبار النظام](#اختبار-النظام)
10. [الأمان والخصوصية](#الأمان-والخصوصية)
11. [الصيانة والتطوير](#الصيانة-والتطوير)
12. [الأسئلة الشائعة](#الأسئلة-الشائعة)

## مقدمة

هذا الدليل يوفر معلومات شاملة حول النموذج الأولي للهوية الرقمية السعودية المبني على منصة EOSIO Private Blockchain. يهدف هذا النموذج الأولي إلى إثبات مفهوم استخدام تقنية البلوكتشين الخاصة لإدارة الهويات الرقمية بطريقة آمنة ولا مركزية وقابلة للتوسع.

### الهدف من النموذج الأولي

يهدف هذا النموذج الأولي إلى:

- إثبات قدرة تقنية EOSIO Private على دعم نظام هوية رقمية وطني
- توضيح آليات إدارة الهوية والمصادقة والتوقيع الرقمي باستخدام العقود الذكية
- تقديم واجهات برمجية وواجهة مستخدم تتيح التفاعل مع النظام
- توفير أساس قابل للتطوير لبناء نظام هوية رقمية كامل

## نظرة عامة على النظام

يتكون النموذج الأولي للهوية الرقمية السعودية من المكونات الرئيسية التالية:

1. **بلوكتشين EOSIO Private**: البنية التحتية الأساسية التي تخزن وتدير بيانات الهوية والمعاملات.
2. **العقود الذكية**: برامج تعمل على البلوكتشين وتنفذ منطق الأعمال لإدارة الهويات والمصادقة والتوقيعات الرقمية.
3. **واجهات برمجة التطبيقات (API)**: توفر طرقًا للتفاعل مع العقود الذكية من خلال تطبيقات خارجية.
4. **واجهة المستخدم**: تطبيق ويب يتيح للمستخدمين التفاعل مع النظام بطريقة سهلة.

### مخطط النظام

```
+----------------------------------+
|        واجهة المستخدم            |
+----------------------------------+
                |
                v
+----------------------------------+
|    واجهات برمجة التطبيقات (API)    |
+----------------------------------+
                |
                v
+----------------------------------+
|          العقود الذكية            |
|   (الهوية، المصادقة، التوقيع)      |
+----------------------------------+
                |
                v
+----------------------------------+
|      بلوكتشين EOSIO Private      |
+----------------------------------+
```

## متطلبات النظام

### متطلبات الأجهزة

- وحدة معالجة مركزية (CPU): 4 أنوية على الأقل
- ذاكرة وصول عشوائي (RAM): 8 جيجابايت على الأقل
- مساحة تخزين: 50 جيجابايت على الأقل (SSD مفضل)
- اتصال إنترنت مستقر

### متطلبات البرمجيات

- نظام تشغيل: Linux (Ubuntu 20.04 LTS أو أحدث) أو macOS أو Windows مع WSL2
- Docker و Docker Compose
- Node.js (الإصدار 14 أو أحدث)
- متصفح ويب حديث (Chrome، Firefox، Safari، أو Edge)

## تثبيت وإعداد النظام

### الخطوة 1: تثبيت المتطلبات الأساسية

تأكد من تثبيت Docker و Docker Compose:

```bash
sudo apt update
sudo apt install -y docker.io docker-compose
sudo systemctl enable docker
sudo systemctl start docker
sudo usermod -aG docker $USER
```

### الخطوة 2: استنساخ المشروع

```bash
git clone https://github.com/example/saudi-digital-identity-poc.git
cd saudi-digital-identity-poc
```

### الخطوة 3: تكامل المكونات

قم بتنفيذ سكريبت التكامل لإعداد جميع المكونات:

```bash
chmod +x integrate.sh
./integrate.sh
```

### الخطوة 4: بدء تشغيل النظام

```bash
chmod +x start.sh
./start.sh
```

بعد تنفيذ هذه الخطوات، سيكون النظام متاحًا على:

- واجهة المستخدم: http://localhost
- واجهة API: http://localhost/api
- واجهة nodeos: http://localhost:8888

### الخطوة 5: إيقاف النظام

عند الانتهاء من استخدام النظام، يمكنك إيقافه باستخدام:

```bash
chmod +x stop.sh
./stop.sh
```

## هيكل المشروع

```
digital_identity_poc/
├── contracts/                  # العقود الذكية
│   ├── identity/               # عقد إدارة الهوية
│   ├── authentication/         # عقد المصادقة
│   └── digitalsignature/       # عقد التوقيع الرقمي
├── api/                        # واجهات برمجة التطبيقات
│   ├── server.js               # خادم API
│   ├── apiClient.js            # واجهة العميل
│   └── package.json            # تبعيات Node.js
├── frontend/                   # واجهة المستخدم
│   └── index.html              # صفحة الويب الرئيسية
├── scripts/                    # سكريبتات مساعدة
│   └── deploy_contracts.sh     # سكريبت نشر العقود الذكية
├── tests/                      # اختبارات النظام
├── eosio/                      # إعدادات EOSIO
├── docker-compose.yml          # تكوين Docker Compose
├── nginx.conf                  # تكوين Nginx
├── integrate.sh                # سكريبت تكامل المكونات
├── start.sh                    # سكريبت بدء التشغيل
├── stop.sh                     # سكريبت إيقاف التشغيل
└── test.sh                     # سكريبت الاختبار
```

## العقود الذكية

النموذج الأولي يتضمن ثلاثة عقود ذكية رئيسية:

### عقد إدارة الهوية (identity.cpp)

يدير هذا العقد دورة حياة الهويات الرقمية، ويوفر الوظائف التالية:

- **إنشاء هوية جديدة**: إنشاء سجل هوية جديد لمستخدم.
- **تحديث هوية**: تحديث معلومات الهوية الحالية.
- **تعليق هوية**: تعليق هوية مستخدم مؤقتًا.
- **تفعيل هوية**: إعادة تفعيل هوية معلقة.
- **التحقق من هوية**: تسجيل عملية تحقق من هوية مستخدم.

#### مثال استخدام:

```bash
# إنشاء هوية جديدة
cleos push action identity.sys create '["issuer1", "user1", "1234567890", "محمد أحمد", "1990-01-01", "بيانات إضافية للمستخدم"]' -p issuer1@active

# التحقق من هوية
cleos push action identity.sys verify '["verifier1", "user1", "بيانات التحقق"]' -p verifier1@active
```

### عقد المصادقة (authentication.cpp)

يدير هذا العقد جلسات المصادقة للمستخدمين، ويوفر الوظائف التالية:

- **تسجيل الدخول**: إنشاء جلسة مصادقة جديدة.
- **تسجيل الخروج**: إنهاء جلسة مصادقة حالية.
- **التحقق من جلسة**: التحقق من صحة جلسة مصادقة.
- **تمديد جلسة**: تمديد فترة صلاحية جلسة مصادقة.
- **تنظيف الجلسات**: إزالة الجلسات منتهية الصلاحية.

#### مثال استخدام:

```bash
# تسجيل الدخول
cleos push action auth.sys login '["user1", "device123", "192.168.1.1", "Mozilla/5.0"]' -p user1@active

# تسجيل الخروج
cleos push action auth.sys logout '["user1", "token123"]' -p user1@active
```

### عقد التوقيع الرقمي (digitalsignature.cpp)

يدير هذا العقد التوقيعات الرقمية للمستندات، ويوفر الوظائف التالية:

- **توقيع مستند**: إنشاء توقيع رقمي لمستند.
- **التحقق من توقيع**: التحقق من صحة توقيع رقمي.
- **إلغاء توقيع**: إلغاء توقيع رقمي سابق.
- **توقيع مجموعة مستندات**: توقيع عدة مستندات في معاملة واحدة.

#### مثال استخدام:

```bash
# توقيع مستند
cleos push action sign.sys sign '["user1", "hash123", "مستند تجريبي", "contract", "بيانات وصفية"]' -p user1@active

# التحقق من توقيع
cleos push action sign.sys verify '["verifier1", "user1", "hash123"]' -p verifier1@active
```

## واجهات برمجة التطبيقات (API)

توفر واجهات برمجة التطبيقات (API) طريقة سهلة للتفاعل مع العقود الذكية من خلال طلبات HTTP. تتضمن الواجهة ثلاثة أقسام رئيسية:

### واجهة إدارة الهوية

- **POST /api/identity/create**: إنشاء هوية جديدة.
- **POST /api/identity/update**: تحديث هوية حالية.
- **POST /api/identity/suspend**: تعليق هوية.
- **POST /api/identity/activate**: تفعيل هوية.
- **POST /api/identity/verify**: التحقق من هوية.
- **GET /api/identity/:user**: الحصول على معلومات هوية.

#### مثال استخدام:

```javascript
// إنشاء هوية جديدة
fetch('/api/identity/create', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    issuer: 'issuer1',
    user: 'user1',
    national_id: '1234567890',
    full_name: 'محمد أحمد',
    date_of_birth: '1990-01-01',
    additional_data: 'بيانات إضافية للمستخدم'
  })
});
```

### واجهة المصادقة

- **POST /api/auth/login**: تسجيل الدخول وإنشاء جلسة.
- **POST /api/auth/logout**: تسجيل الخروج وإنهاء جلسة.
- **POST /api/auth/verify**: التحقق من صحة جلسة.
- **POST /api/auth/extend**: تمديد فترة صلاحية جلسة.

#### مثال استخدام:

```javascript
// تسجيل الدخول
fetch('/api/auth/login', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    user: 'user1',
    device_id: 'device123',
    ip_address: '192.168.1.1',
    user_agent: 'Mozilla/5.0'
  })
});
```

### واجهة التوقيع الرقمي

- **POST /api/signature/sign**: توقيع مستند.
- **POST /api/signature/verify**: التحقق من توقيع.
- **POST /api/signature/revoke**: إلغاء توقيع.
- **POST /api/signature/batchsign**: توقيع مجموعة مستندات.
- **GET /api/signature/user/:user**: الحصول على توقيعات مستخدم.

#### مثال استخدام:

```javascript
// توقيع مستند
fetch('/api/signature/sign', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    user: 'user1',
    document_hash: 'hash123',
    document_name: 'مستند تجريبي',
    document_type: 'contract',
    metadata: 'بيانات وصفية'
  })
});
```

## واجهة المستخدم

توفر واجهة المستخدم طريقة سهلة للتفاعل مع النظام من خلال متصفح الويب. تتضمن الواجهة ثلاثة أقسام رئيسية:

### قسم إدارة الهوية

يتيح هذا القسم للمستخدمين:

- إنشاء هويات جديدة
- البحث عن هويات حالية
- تحديث معلومات الهوية
- تعليق وتفعيل الهويات

### قسم المصادقة

يتيح هذا القسم للمستخدمين:

- تسجيل الدخول وإنشاء جلسات
- تسجيل الخروج وإنهاء جلسات
- التحقق من صحة جلسات
- تمديد فترة صلاحية جلسات

### قسم التوقيع الرقمي

يتيح هذا القسم للمستخدمين:

- توقيع مستندات رقميًا
- التحقق من صحة التوقيعات
- إلغاء توقيعات سابقة
- عرض قائمة بالتوقيعات الحالية

### الوصول إلى واجهة المستخدم

بعد تشغيل النظام، يمكن الوصول إلى واجهة المستخدم من خلال:

```
http://localhost
```

## اختبار النظام

يتضمن النموذج الأولي مجموعة شاملة من الاختبارات للتحقق من صحة عمل جميع المكونات:

### اختبار العقود الذكية

```bash
# تنفيذ اختبارات عقد الهوية
docker exec -it eosio_nodeos /tests/test_identity.sh

# تنفيذ اختبارات عقد المصادقة
docker exec -it eosio_nodeos /tests/test_authentication.sh

# تنفيذ اختبارات عقد التوقيع الرقمي
docker exec -it eosio_nodeos /tests/test_signature.sh
```

### اختبار واجهات API

```bash
# تنفيذ اختبارات واجهات API
./tests/test_api.sh
```

### اختبار واجهة المستخدم

```bash
# تنفيذ اختبارات واجهة المستخدم
./tests/test_ui.sh
```

### اختبار التكامل

```bash
# تنفيذ اختبارات التكامل
./tests/test_integration.sh
```

## الأمان والخصوصية

### ميزات الأمان

النموذج الأولي يتضمن عدة ميزات أمان:

1. **التحقق من الصلاحيات**: يتطلب كل إجراء توقيعًا من الحساب المناسب.
2. **التحقق من البيانات**: يتم التحقق من صحة جميع البيانات المدخلة.
3. **تشفير البيانات**: يتم تخزين البيانات الحساسة بشكل مشفر.
4. **سجل المعاملات**: يتم تسجيل جميع المعاملات على البلوكتشين للتدقيق.

### اعتبارات الخصوصية

النموذج الأولي يراعي خصوصية البيانات من خلال:

1. **تخزين الحد الأدنى من البيانات**: يتم تخزين الحد الأدنى من البيانات الشخصية.
2. **التحكم في الوصول**: يتم التحكم في الوصول إلى البيانات بناءً على الصلاحيات.
3. **إخفاء الهوية**: يمكن إخفاء هوية المستخدمين في بعض العمليات.

## الصيانة والتطوير

### الصيانة الدورية

للحفاظ على أداء النظام، يوصى بإجراء الصيانة الدورية التالية:

1. **تحديث البرمجيات**: تحديث Docker والتبعيات الأخرى بانتظام.
2. **نسخ احتياطي للبيانات**: إجراء نسخ احتياطي منتظم لبيانات البلوكتشين.
3. **مراقبة الأداء**: مراقبة أداء النظام وتحسينه عند الحاجة.

### تطوير النظام

لتطوير النظام وإضافة ميزات جديدة:

1. **تطوير العقود الذكية**: تعديل أو إضافة عقود ذكية جديدة.
2. **تحديث واجهات API**: تحديث أو إضافة نقاط نهاية API جديدة.
3. **تحسين واجهة المستخدم**: تحسين تجربة المستخدم وإضافة ميزات جديدة.

## الأسئلة الشائعة

### س: كيف يمكنني إعادة تشغيل النظام بعد إيقافه؟

ج: يمكنك إعادة تشغيل النظام باستخدام سكريبت البدء:

```bash
./start.sh
```

### س: كيف يمكنني إضافة مستخدمين جدد إلى النظام؟

ج: يمكنك إضافة مستخدمين جدد من خلال:

1. إنشاء حساب EOSIO جديد باستخدام `cleos create account`.
2. استخدام واجهة إدارة الهوية لإنشاء هوية للمستخدم الجديد.

### س: كيف يمكنني تغيير إعدادات الشبكة؟

ج: يمكنك تعديل إعدادات الشبكة من خلال تعديل ملف `docker-compose.yml` وإعادة تشغيل النظام.

### س: هل يمكن استخدام النظام في بيئة الإنتاج؟

ج: هذا النموذج الأولي مصمم لإثبات المفهوم وليس للاستخدام في بيئة الإنتاج. للاستخدام في بيئة الإنتاج، يجب إجراء تحسينات إضافية على الأمان والأداء والتوافر.

---

لمزيد من المعلومات أو الاستفسارات، يرجى التواصل مع فريق الدعم الفني.
